[[mechanical_hardware]]

==  第２章　メカハードウェア

本章ではeVやそこに至るまでのでしぷろんぷと関連機体の系譜や構造的特徴を説明しつつ、
かわロボの多様性に繋がるためのシステムソフトウェアや制御関連要素をeVに実装するのかを説明します。
最後にその他の構造的特徴を簡単に説明します。

=== 外観

[ch2_eV3_whole]
.eV(2016年かわロボ仕様)外観図
image::./eV_basic_design/eV3_v36.png[align="center"]

<<kawarobo_2013_1>>や<<kawarobo_2013_2>>に挙げた機体に比べてeVは見た目が大きく異なっているかと思います。
これはeVを構成する自作部品がすべて３Ｄプリンタにより制作されていることによります。
実はでしぷろんぷとでは２０１２年より３Ｄプリンタ製作の機体を継続的に製作しています。
次の項で簡単に３Ｄプリンタ製作機体のこれまでについて簡単に触れた後eVのメカを解説していきます。

<<<

=== 系譜

2012年::
神風　汎用決戦型２式. アーム部のギアボックスとパイロット(Tuxペンギン)を３Ｄプリンタで製作

[ch2_kamikaze]
.神風　汎用決戦型２式 footnote:[http://www.kawasaki-net.ne.jp/robo_old/robo12/battle/s248.jpg]
image::./kawarobo/2012/s248.jpg[width="200", align="center"]

2013年::
いつヤルか？ＫＹＯでしょ！. ２０１２年の機体を３Ｄプリンタ向けに再設計

[ch2_kyo_desho]
.いつヤルか？ＫＹＯでしょ！. footnote:[http://www.kawasaki-net.ne.jp/robo_old/robo13/uploads/2013/09/228.jpg]
image::./kawarobo/2013/s228.jpg[width="200", align="center"]

2014年::
ardbeg. 初めて３Ｄプリンタでの製作を前提としてフルスクラッチ設計<<4>>．脚機構の一部は切削加工のパーツを採用．

[ch2_ardbeg]
.ardbeg footnote:[http://www.kawasaki-net.ne.jp/robo_old/robo14/uploads/2014/09/255.jpg]
image::./kawarobo/2014/s255.jpg[width="200", align="center"]

2015年::
製作機体なし

2016年::
eV. 既成品以外のパーツをすべて３Ｄプリンタで製作.

[ch2_ardbeg]
.ardbeg footnote:[http://www.kawasaki-net.ne.jp/robo/wp-content/uploads/2016/09/s229.jpg]
image::./kawarobo/2016/s229.jpg[width="200", align="center"]

[cols="1,2,2,2,2, options="header", text-align="center"] 
.３Ｄプリンタを利用したでしぷろんぷとかわロボの機体比較
|===

|
2+|パーツ製作
2+|メカ機構 

|年
|腕
|脚
|腕
|脚

|2012
|切削加工　　
(３Ｄプリンタ) footnoteref:[ch2_sub_method, 一部のパーツの製作に利用]
|切削加工　
|シリアルリンク
|閉リンク

|2013
|３Ｄプリンタ
|３Ｄプリンタ　
(切削加工) footnoteref:[ch2_sub_method]
|閉リンク footnoteref:[ch2_arm_ristrict, 2013年よりアームは閉リンクでなければならなくなりました]
|閉リンク

|2014
|３Ｄプリンタ
|３Ｄプリンタ　
(切削加工) footnoteref:[ch2_sub_method]
|閉リンク footnoteref:[ch2_arm_ristrict]
|閉リンク

|2015
|-
|-
|-
|-

|2016
|３Ｄプリンタ
|３Ｄプリンタ
|閉リンク footnoteref:[ch2_arm_ristrict]
|シリアルリンク

|===


部品の製作方法と機体の身体構造が主な違いとしてあげられます。
次はこの２つの観点からeV製作に至るまでの経緯を説明します。

[NOTE]
====
シリアルリンク（開リンク）とパラレルリンク（閉リンク）の違いに関しては次項以降で説明します.
====

==== 部品の製作方法からみたeV

でしぷろんぷとでは２０１２年に３Ｄプリンタ（MakerBot社製 Replicator）を導入しかわロボ製作に取り込みました。
しかしながら、この時点では機体の構成部品のうちアームの一部のパーツを製作するのにとどまり、
その他のパーツはポリカーボネート板やアルミ板を卓上のＮＣフライス盤を使用して作成していました。
この当時は３Ｄプリンタが各社から発売されまさに黎明期で、部品精度もまだまだ低く歩留まりも悪いため
かわロボ製作に全面的に取り入れるのは難しそうだという使用感を持ったのを覚えています。

この年の年末MakerBot社はＡＢＳフィラメントに本格的に対応したＲｅｐｌｉｃａｔｏｒ２Ｘをリリースしました。
これによりようやく３Ｄプリンタでかわロボのほぼすべてのパーツを製作する下地が整いました。
これを受けて私達は２０１３年、２０１４年にかけてほぼすべてのパーツを３Ｄプリンタで製作した機体を製作しました。
しかし歩留まりの悪さは大きくは改善されず、また大きなパーツを製作した時に反りの抑制は十分ではありませんでした。
そのため同じパーツを何度かプリントし直す必要が有り、かわロボの機体のメカハードウェアを製作するだけで手一杯というのが実情でした。

そんな中２０１５年に筆者はＺｏｒｔｒａｘＭ２００を知ることになります。
このプリンタは単純な温度管理を行うだけではなく、特殊なビルドプラットフォームを採用することで
ＡＢＳフィラメントを使用した場合の反りの抑制が大幅に改善されていました。
これにより部品製作の歩留まりが向上し、いままでは困難であった複数パーツの同時プリントが実現できるようになりました。
これならば機体を製作したうえで、その上で動作するソフトウェア・制御システムを構築することができるのではと
２０１６年にeVの製作にチャレンジする事になります。

[NOTE]
====
近年ホビーユース向けに各種発売されているプリンタはほぼＦＤＭと言われるタイプのプリンタです。
詳細は@kyo46の新刊<<4>>に譲りますが、黎明期に主流であったＰＬＡというフィラメントはロボットの構造部材
として使用するには十分な機械特性を持っておらず、また製作物の仕上がりに影響する積層ピッチも十分なものではありませんでした。
ＡＢＳフィラメントを使用することで前者は解決するのですが、一般にこのＡＢＳは温度変化に弱くプリントする際に変形（
底面から端点が剥離することから反りが起きると言われます）しやすいためＰＬＡのものに比べ仕上がりがよくありませんでした。
Ｒｅｐｌｉｃａｔｏｒ２Ｘでは全面にカバーを持つ筐体にして温度変化対策を入れるとともに、
積層ピッチがこれまでの標準であった０．２［mm］から０．１［mm］に大きく改善されました。
====

==== 身体構造からみたeV

かわロボでは無線操作用インターフェースに関連する機器（送信機となるプロポ、機体側の受信機、受信機からの信号に従いモータを駆動するモータアンプ）
を除いてソフトウェアプログラムが機体の制御に介在している例は多くはありません。特にＪＩＳ（ＩＳＯ）規格でいうところのロボットの要件、つまり
２軸以上の制御を統合して行うケースはまれと言えるでしょう。これはつまり単自由度レベルでの操作を行うのが主流であることを示しています。

一方でかわロボでは腕（アーム）機構と脚機構を持つことが競技規則により定められています。
また１章でも軽く触れましたがこれらには機構や軌道に制約が課されています、単自由度レベルで操作でどうやってこれらの要件を実現するのでしょうか。
これは閉リンク機構を用いることで実現されます。

===== 閉リンク機構

リンク構造とは関節と関節に接続された構造部材の組み合わせで構成されるメカ構造を指します。
特に *閉* リンク機構は、(<<ch2_closed_link>>)に示すような機構です footnote:[この例では説明を簡略化するために平面上で動作する機構としています]。

[[ch2_closed_link]]
.閉リンク
image::./ch2/closed_link.png[width="200", align="center"]

関節は黄色または緑色の丸で構造部材は青い四角で表現しています。関節は紙面に対して垂直な軸周りに回転することができ全部で４つ存在しています。
またすべての関節が他の２関節と構造部材で接続されており、関節と構造部材とたどっていくと元の関節にたどり着くことができます。
このようなループが形成されるリンク構造を閉リンク（パラレルリンク）機構と呼びます。

閉リンク機構ではすべての関節を駆動させることで先端の手先効果器（エンドエフェクタ、ハンド）を動作させることもできますが、
一部の関節のみを駆動するだけでも動作させることができます。ちょうど図に示した例がそれに当たります。
緑色の関節にはアクチュエータが搭載されておらず、黄色の関節のみが能動的に回転することが可能です。黄色の関節が回転すると
それに伴って他の緑色の関節が受動的に回転し、結果として先端のエンドエフェクタが動作します。この時関節の配置の仕方により
エンドエフェクタの軌道が変化します。この軌道を揺動的なものに調整することで機体のアームを設計し、地面をけることができる
ような軌道に調整することで機体の脚機構を設計することになります。
この様に閉リンク機構では能動的に動かす関節数 footnote:[アクチュエータの数、もしくは能動的に駆動することのできる自由度数ということもできます]
が少なくても複雑な軌道を実現することができるのです。

[NOTE]
====
今回扱った関節は紙面に対して垂直な軸周りに回転しますのみでしたが、
実際のロボットの関節は回転する軸が異なっていたり、回転ではなく並進する関節もあります。
更には回転や並進など複数の動作を組み合わせた動きを行う関節も存在します。
そのため一般的な閉リンク機構は寄り複雑な動作を実現することが可能です。
また実際には机上でリンク機構を設計できていてもどうやって実際の部品・機体構造として実現するかはまた別問題です。
ここにメカ構造としてのロボットの面白みの一端があるのだと思います。
====

閉というからには当然開リンクもあります。開リンクをロボットに採用するとどのような効果が見込めるのか次項ではそれを説明したいと思います。


===== 開リンク機構

前項でループが形成されるリンク構造を閉リンク（パラレルリンク）機構と呼ぶと説明しました。
開リンクはこの逆でループが形成されないリンク構造を持つ機構で、シリアルリンク機構とも呼ばれます(<<ch2_serial_link>>)。
開リンク機構では図から一目瞭然かもしれませんが、関節の数に対してエンドエフェクタが到達し得る領域が閉リンク機構に
比べて広く取ることができ、ひとつの機構で様々な目的に適用することが可能です。
同程度の自由度により構成する閉リンク機構ではこのような汎用性を担保することは難しいです。

ではなぜかわロボで開リンク機構を作用する機体が見られないのでしょうか、それは実現の難しさにあると思います。
閉リンクでは能動的に駆動可能な関節は最低１つあれば十分でしたが、開リンク機構ではすべての関節が能動的に駆動できなければ
なりません footnote:[適用用途次第ではこの限りではありませんが簡単のため今回は説明を省きます]。
そのため機体には多数のアクチュエータを搭載しなければなりませんし、それを強調して動作させるための電気・制御およびソフトウェア
システムを構成しなければなりません。単純にメカハードウェアだけを構成すれば良いわけではないのです。

ここでＪＩＳ（ＩＳＯ）がいうところのロボットの要件を思い出してみると、２自由度以上の関節と半自立動作がありました。
これは開リンク footnote:[もちろん閉リンク機構を複数搭載してこの要件を満たすことは可能です] を広く想定しているのです。
実際、産業用ロボットやエンタテイメントロボットのようなロボットでは開リンク機構を採用している例がほとんどです。

[[ch2_serial_link]]
.開リンク
image::./ch2/serial_link.png[width="200", align="center"]

=== 多様性を実現するための機構

これまでの議論を踏まえて、eVではかわロボ機体によるロボット　footnote:[ここでいうロボットは標準規格<<3>>をみたすロボットのことを言います]
の実現を目標として設計を行いました。それにより閉リンク構造で構成した場合の機体に比べて高い自由度・汎用性をもたせようとしています。
このことがかわロボの多様性に繋がると筆者は信じています。

ここで、eVをリンク機構の観点で見てみましょう。<<ch2_whole>> は筆者がeVを設計するにあたり最初に関節及びリンク配置を検討するために
作成したＣＡＤモデルです footnote:[Ｆｕｓｉｏｎ３６０にて作成。]。４本の脚部と１本の首（顔）部があるのが見て取れます。
イヌをもしているためこのような構造になっています。

[NOTE]
====
自然界に存在する生き物もマクロ的に見ると開リンク構造と捉えることができる例が多いと思います
footnote:[筋骨格などはこの限りではないのでしょうが手先まで捉えて見ると閉リンクとは言えないと考えています] 。
そのため生き物を模したロボットを製作する場合開リンク構造で表現したほうがより広範囲の生物を模擬することができるかと思います。
====

さて、かわロボでは移動目的ではなく対戦相手を攻撃する腕部を有しなければなりません。
そのためeVでは首部をかわロボにおける腕部と見立てて、脚部と腕部を持つことという競技規則を満たしています。
次はそれぞれの構造をもう少し細かく見ていきましょう。

[[ch2_whole]]
.eVリンク構造
image::./eV_basic_design/whole.png[width="320", align="center"]

==== 腕部の機構

腕部は開リンクとして設計することができません。
メカハードウェアとして揺動リンク機構を持たなければならないと競技規則　第３章　第１１条にかかれているからです。
そのためスライダークランク機構という閉リンク機構により顔部（腕部）を実現しています。
スライダークランク機構そのものの機構に関しては紙面の都合上@kyo46の新刊<<4>>に譲るとして
ここでは簡単に説明します。まず首部分に接続された下顔部に対して上顔部が駆動するようになっています。
この時上顔の歯の部分がちょうど腕部に見立てた場合のエンドエフェクタに相当することになり<<ch2_arm_kinematics>>に
示す作動軌跡を描くことになります。これにより対戦相手を把持（イヌ的に言うならば噛みつく）し全身を使って
持ちあげて行動不能にしたり、持ち上げつつ前進することでフィールド外へ押し出すことを狙っています。

[[ch2_arm_kinematics]]
.eV　腕構造
image::./eV_basic_design/arm_kinematics.png[width="320", align="center"]

[[ch2_arm_actual1]]
.eV　腕実物（開口時）
image::./dcim/DSC01016.jpg[width="320", align="center"]

[[ch2_arm_actual2]]
.eV　腕実物（閉口時）
image::./dcim/DSC01017.jpg[width="320", align="center"]

==== 脚部の機構

脚部に関しては競技規則の第３章　第１０条で細かく規定されています。
リンク機構を有していて、結果として以下のように順送り構造を除いた移動機構が実現できれば良いと書かれています。

[quote, 公式サイト,バトルロボット部門　競技規則　第３章　第１０条　抜粋]
____
1. 脚機構は、往復運動を行う部位を接地部として、リンク機構を用いて移動する様設計されていること。また、接地部を有する部品がリンク機構に組み込まれている事。
2. 脚機構の接地点は、その部位が取り付けられている回転運動部の、回転中心を取り囲む軌跡を描いて動作をしてはならない。
3. 脚機構は、車輪および無限軌道（クローラー方式の駆動機構など）や、それに類似した順送り構造を除いた移動機構を有するものとする。
____

そのため開リンク構造とソフトウェア制御により脚の関節を強調させて駆動させることで条件を満たす機体の製作が可能となります
footnote:[従来型の機体でもメカハードウェア的に開リンクとリレー・スイッチを組み合わせて２自由度を切り替えて動作させるかわロボ機体は有りました（第２３回大会出場機体 228 kbar）]。
開リンク機構のため脚先の軌道はある程度自由に位置決めすることができます。そのため<<ch2_leg_traj>>に示すような障害物の乗り越えも
ソフトウェアの工夫次第で実現することが可能になるのです。ハードウェアの工夫だけではなくその先の制御を含めて総合的に開発を行わ
なければ良いものはできません、ここが難しいところでは有りますがロボット開発の醍醐味でも有ります。

eVでは目的に応じて動的に脚部先端の位置の軌道生成を行い、それを満たす関節の角度を逆運動学を解くことによりリアルタイムで
動作生成を行う予定でしたが時間の都合もあり２０１６年の大会には間に合いませんでした。
そのため今回は逆運動学などのアルゴリズムについての説明は省きます、詳細を知りたい場合には文献<<5>>や<<6>>が詳しいです。

[[ch2_leg_kinematics]]
.eV　脚構造と基本的な動き
image::./eV_basic_design/leg_kinematics.png[width="320", align="center"]

[[ch2_leg_traj]]
.eV　開リンク脚機構による障害物の乗り越え
image::./eV_basic_design/leg_traj.png[width="420", align="center"]

[IMPORTANT]
====
ここではソフトウェア制御の重要性に重きをおいて説明を行いましたが、決してハードウェアをないがしろにしている訳ではありません。
如何にソフトウェアや制御の工夫次第と言っても、ロボットの身体性（関節や構造部材の配置）次第では思った足先軌道が得られず、
制御をどう組んでも目的を達成できないことも有ります。
メカハードウェア設計とソフトウェア・制御設計は総合的に設計しなければならないのです。
====

=== その他の特徴

eVはこれ以外にも従来のかわロボの機体に比べ異なる特徴をもちます。　

[ev_charactaristics]
====
. 首と尻尾の根本の駆動可能な関節
.. 試合開始時に指定のサイズに収まるよう変形可能です(<<ch2_expansion>>)
.. 尻尾の動きにより起き上がり動作（転倒復帰）ができるかもしれません footnote:[この機能は未検証です]
. ３Ｄプリンタの全面的採用
.. 既成品以外のパーツはすべて３Ｄプリンタで製作しています
.. 高価なその他工作機械を利用する手段を持たないでも製作できます
.. ３Ｄプリンタで部品製作が完結するので電気・制御・ソフトウェアの開発に時間が避けます
.. ３Ｄプリンタすら持たない人でも３Ｄプリントサービスの利用によりかわロボ機体が作成できます
. サーボモータの全面的採用
.. 市販サーボモータの採用により関節単体での位置決めに気を払う必要がありません
.. 減速機がサーボモータ内に組み込まれているため３Ｄプリンタが苦手とする小部品を製作する必要がありません
. 必要最低限な既成品
.. サーボ関連のパーツ以外はすべて３Ｄプリンタで製作しています
.. サーボ、サーボホーン、これらの固定のためのＭ３未満のネジ、その他電装部品のみを購入しています
. 工具レスで収納サイズまで分解できる構造 (<<ch2_neji_asm>>, <<ch2_neji_purge>>)
.. でしぷろんぷとの２０１４年の機体(Ardbeg)から継承した構造です
.. ３Ｄプリンタで製作したネジにより大部品同士を連結しており分解がコイン１枚でできます
====

[[ch2_expansion]]
.eV　機体の変形 footnote:[顔が最終形と異なるのはご愛嬌としてください]
image::./eV_basic_design/expansion.png[width="240", align="center"]

<<<

[[ch2_neji_asm]]
.eV　３Ｄプリントネジによる締結
image::./ch2/neji_asm.png[width="320", align="center"]

[[ch2_neji_purge]]
.eV　３Ｄプリントネジによる分解
image::./eV/purged.png[width="320", align="center"]

<<<

==== まとめ

最後に全体構成を<<ch2_spec>>に示します。

[[ch2_spec]]
.eV　全体構成
image::./eV_basic_design/spec.png[width="420", align="center"]

